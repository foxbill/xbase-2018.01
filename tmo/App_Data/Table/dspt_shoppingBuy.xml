<?xml version="1.0" encoding="utf-8"?><DataSourceSchema xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"><Id>dspt_shoppingBuy</Id><IsAutoNewLine>false</IsAutoNewLine><UserSqlCommands /><PageSize>10</PageSize><References /><LookupFields /><PrimaryKeys><string>ID</string></PrimaryKeys><InsertCommand><CommandText>insert into pt_orderDetailCustomValue(ID,OrderId,ProductId,FieldValueId,DelFlag,Summary,Creater,CreateTime,Updater,UpdateTime)
 select @ID,@OrderId,ProductId,FieldValueId,0,'',@user,GETDATE(),@user,GETDATE() from pt_shoppingCartFieldValue where ShoppingCartId=@ShoppingCartId</CommandText><CommandType>Text</CommandType><QueryParams><ParameterSchema><Id>@ID</Id><DataSize>4</DataSize><Direction>Input</Direction><DataType>String</DataType><DefaultValue /></ParameterSchema><ParameterSchema><Id>@OrderId</Id><DataSize>4</DataSize><Direction>Input</Direction><DataType>String</DataType><DefaultValue /></ParameterSchema><ParameterSchema><Id>@user</Id><DataSize>4</DataSize><Direction>Input</Direction><DataType>String</DataType><DefaultValue>[LoginUser.Id]</DefaultValue></ParameterSchema><ParameterSchema><Id>@ShoppingCartId</Id><DataSize>4</DataSize><Direction>Input</Direction><DataType>String</DataType><DefaultValue /></ParameterSchema></QueryParams></InsertCommand><UpdateCommand><CommandText>UPDATE pt_shoppingCart SET  [ID]=@ID, [SessionId]=@SessionId, [ProductId]=@ProductId, [Total]=@Total, [sCount]=@sCount, [DelFlag]=@DelFlag, [Creater]=@Creater, [CreateTime]=@CreateTime, [Updater]=@Updater, [UpdateTime]=@UpdateTime WHERE  [ID]=@pk_ID</CommandText><CommandType>Text</CommandType></UpdateCommand><DeleteCommand><CommandText>MERGE pt_shoppingCart AS d 
USING 
    pt_orderDetail  
AS s
ON s.ProductID = d.ProductId and d.Creater=s.Creater and s.Creater=@user
WHEN MATCHED THEN 
Delete ;</CommandText><CommandType>Text</CommandType><QueryParams><ParameterSchema><Id>@user</Id><DataSize>4</DataSize><Direction>Input</Direction><DataType>String</DataType><DefaultValue>[LoginUser.Id]</DefaultValue></ParameterSchema></QueryParams></DeleteCommand><SelectCommand><CommandText>SELECT sc.ID,sc.ProductId,p.Name,p.Picture,sc.sCount,p.CostPirce ,pm.Name Model
      ,('品牌：'+pb.Name+' 系列：'+ps.Name ) BrandSeries
      ,(ISNULL(sc.sCount,0)*p.CostPirce) Total
      ,STUFF(

                        (

                              SELECT ','+cus.customFieldValue

                              FROM (select scfv.ShoppingCartId,scfv.ProductId,(pcf.Display+'：'+pcfv.Value) customFieldValue from pt_shoppingCartFieldValue scfv
left join pt_productCustomFieldValue pcfv on pcfv.ID=scfv.FieldValueId
left join pt_productCustomField pcf on pcf.ID=pcfv.FieldId
) cus

                              WHERE cus.ShoppingCartId = sc.ID and cus.ProductId=sc.ProductId

                              FOR XML PATH('')

                        )

                        ,1,1,''

                  ) AS CustomFieldValuelist
  FROM pt_shoppingCart sc
  left join pt_product p on sc.ProductId=p.ID
  left join pt_productType pt on pt.ID=p.Type
  left join pt_productModel pm on pm.ID=p.Model and p.Type=pm.TypeId
  left join pt_productBrand pb on pb.ID=p.Brand
  left join pt_productSeries ps on ps.ID=p.Series and p.Brand=ps.BrandId
where sc.Creater=@user</CommandText><CommandType>Text</CommandType><QueryParams><ParameterSchema><Id>@user</Id><DataSize>4</DataSize><Direction>Input</Direction><DataType>String</DataType><DefaultValue>[LoginUser.Id]</DefaultValue></ParameterSchema></QueryParams></SelectCommand><Fields><FieldSchema><Id>ID</Id><Title>ID</Title><DisplayWidth>60</DisplayWidth><Option><QueryParams /><Options /></Option><IsInForm>true</IsInForm><IsInCard>true</IsInCard><IsKey>true</IsKey><ExtendType>None</ExtendType><ReadOnly>false</ReadOnly><Valids /><DataType>String</DataType><Visable>true</Visable><IsAutoInc>false</IsAutoInc><IsGUID>false</IsGUID></FieldSchema><FieldSchema><Id>SessionId</Id><Title>SessionId</Title><DisplayWidth>60</DisplayWidth><Option><QueryParams /><Options /></Option><IsInForm>true</IsInForm><IsInCard>true</IsInCard><IsKey>false</IsKey><ExtendType>None</ExtendType><ReadOnly>false</ReadOnly><Valids /><DataType>String</DataType><Visable>true</Visable><IsAutoInc>false</IsAutoInc><IsGUID>false</IsGUID></FieldSchema><FieldSchema><Id>ProductId</Id><Title>ProductId</Title><DisplayWidth>60</DisplayWidth><Option><QueryParams /><Options /></Option><IsInForm>true</IsInForm><IsInCard>true</IsInCard><IsKey>false</IsKey><ExtendType>None</ExtendType><ReadOnly>false</ReadOnly><Valids /><DataType>String</DataType><Visable>true</Visable><IsAutoInc>false</IsAutoInc><IsGUID>false</IsGUID></FieldSchema><FieldSchema><Id>Total</Id><Title>Total</Title><DisplayWidth>60</DisplayWidth><Option><QueryParams /><Options /></Option><IsInForm>true</IsInForm><IsInCard>true</IsInCard><IsKey>false</IsKey><ExtendType>None</ExtendType><ReadOnly>false</ReadOnly><Valids /><DataType>String</DataType><Visable>true</Visable><IsAutoInc>false</IsAutoInc><IsGUID>false</IsGUID></FieldSchema><FieldSchema><Id>sCount</Id><Title>sCount</Title><DisplayWidth>60</DisplayWidth><Option><QueryParams /><Options /></Option><IsInForm>true</IsInForm><IsInCard>true</IsInCard><IsKey>false</IsKey><ExtendType>None</ExtendType><ReadOnly>false</ReadOnly><Valids /><DataType>String</DataType><Visable>true</Visable><IsAutoInc>false</IsAutoInc><IsGUID>false</IsGUID></FieldSchema><FieldSchema><Id>DelFlag</Id><Title>DelFlag</Title><DisplayWidth>60</DisplayWidth><Option><QueryParams /><Options /></Option><IsInForm>true</IsInForm><IsInCard>true</IsInCard><IsKey>false</IsKey><ExtendType>None</ExtendType><ReadOnly>false</ReadOnly><Valids /><DataType>Int32</DataType><Visable>true</Visable><IsAutoInc>false</IsAutoInc><IsGUID>false</IsGUID></FieldSchema><FieldSchema><Id>Creater</Id><Title>Creater</Title><DisplayWidth>60</DisplayWidth><Option><QueryParams /><Options /></Option><IsInForm>true</IsInForm><IsInCard>true</IsInCard><IsKey>false</IsKey><ExtendType>None</ExtendType><ReadOnly>false</ReadOnly><Valids /><DataType>String</DataType><Visable>true</Visable><IsAutoInc>false</IsAutoInc><IsGUID>false</IsGUID></FieldSchema><FieldSchema><Id>CreateTime</Id><Title>CreateTime</Title><DisplayWidth>60</DisplayWidth><Option><QueryParams /><Options /></Option><IsInForm>true</IsInForm><IsInCard>true</IsInCard><IsKey>false</IsKey><ExtendType>None</ExtendType><ReadOnly>false</ReadOnly><Valids /><DataType>DateTime</DataType><Visable>true</Visable><IsAutoInc>false</IsAutoInc><IsGUID>false</IsGUID></FieldSchema><FieldSchema><Id>Updater</Id><Title>Updater</Title><DisplayWidth>60</DisplayWidth><Option><QueryParams /><Options /></Option><IsInForm>true</IsInForm><IsInCard>true</IsInCard><IsKey>false</IsKey><ExtendType>None</ExtendType><ReadOnly>false</ReadOnly><Valids /><DataType>String</DataType><Visable>true</Visable><IsAutoInc>false</IsAutoInc><IsGUID>false</IsGUID></FieldSchema><FieldSchema><Id>UpdateTime</Id><Title>UpdateTime</Title><DisplayWidth>60</DisplayWidth><Option><QueryParams /><Options /></Option><IsInForm>true</IsInForm><IsInCard>true</IsInCard><IsKey>false</IsKey><ExtendType>None</ExtendType><ReadOnly>false</ReadOnly><Valids /><DataType>DateTime</DataType><Visable>true</Visable><IsAutoInc>false</IsAutoInc><IsGUID>false</IsGUID></FieldSchema><FieldSchema><Id>Name</Id><DisplayWidth>60</DisplayWidth><Option><QueryParams /><Options /></Option><IsInForm>true</IsInForm><IsInCard>true</IsInCard><IsKey>false</IsKey><ExtendType>None</ExtendType><ReadOnly>false</ReadOnly><Valids /><DataType>String</DataType><Visable>true</Visable><IsAutoInc>false</IsAutoInc><IsGUID>false</IsGUID></FieldSchema><FieldSchema><Id>Picture</Id><DisplayWidth>60</DisplayWidth><Option><QueryParams /><Options /></Option><IsInForm>true</IsInForm><IsInCard>true</IsInCard><IsKey>false</IsKey><ExtendType>None</ExtendType><ReadOnly>false</ReadOnly><Valids /><DataType>String</DataType><Visable>true</Visable><IsAutoInc>false</IsAutoInc><IsGUID>false</IsGUID></FieldSchema><FieldSchema><Id>CostPirce</Id><DisplayWidth>60</DisplayWidth><Option><QueryParams /><Options /></Option><IsInForm>true</IsInForm><IsInCard>true</IsInCard><IsKey>false</IsKey><ExtendType>None</ExtendType><ReadOnly>false</ReadOnly><Valids /><DataType>Decimal</DataType><Visable>true</Visable><IsAutoInc>false</IsAutoInc><IsGUID>false</IsGUID></FieldSchema><FieldSchema><Id>Model</Id><DisplayWidth>60</DisplayWidth><Option><QueryParams /><Options /></Option><IsInForm>true</IsInForm><IsInCard>true</IsInCard><IsKey>false</IsKey><ExtendType>None</ExtendType><ReadOnly>false</ReadOnly><Valids /><DataType>String</DataType><Visable>true</Visable><IsAutoInc>false</IsAutoInc><IsGUID>false</IsGUID></FieldSchema><FieldSchema><Id>Series</Id><DisplayWidth>60</DisplayWidth><Option><QueryParams /><Options /></Option><IsInForm>true</IsInForm><IsInCard>true</IsInCard><IsKey>false</IsKey><ExtendType>None</ExtendType><ReadOnly>false</ReadOnly><Valids /><DataType>String</DataType><Visable>true</Visable><IsAutoInc>false</IsAutoInc><IsGUID>false</IsGUID></FieldSchema><FieldSchema><Id>Brand</Id><DisplayWidth>60</DisplayWidth><Option><QueryParams /><Options /></Option><IsInForm>true</IsInForm><IsInCard>true</IsInCard><IsKey>false</IsKey><ExtendType>None</ExtendType><ReadOnly>false</ReadOnly><Valids /><DataType>String</DataType><Visable>true</Visable><IsAutoInc>false</IsAutoInc><IsGUID>false</IsGUID></FieldSchema><FieldSchema><Id>CustomFieldValuelist</Id><DisplayWidth>60</DisplayWidth><Option><QueryParams /><Options /></Option><IsInForm>true</IsInForm><IsInCard>true</IsInCard><IsKey>false</IsKey><ExtendType>None</ExtendType><ReadOnly>false</ReadOnly><Valids /><DataType>String</DataType><Visable>true</Visable><IsAutoInc>false</IsAutoInc><IsGUID>false</IsGUID></FieldSchema><FieldSchema><Id>BrandSeries</Id><DisplayWidth>60</DisplayWidth><Option><QueryParams /><Options /></Option><IsInForm>true</IsInForm><IsInCard>true</IsInCard><IsKey>false</IsKey><ExtendType>None</ExtendType><ReadOnly>false</ReadOnly><Valids /><DataType>String</DataType><Visable>true</Visable><IsAutoInc>false</IsAutoInc><IsGUID>false</IsGUID></FieldSchema></Fields><TableName>pt_shoppingCart</TableName><IsPagingByParams>false</IsPagingByParams></DataSourceSchema>